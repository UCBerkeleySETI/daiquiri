{% load i18n %}

<p>
    {% blocktrans %}
        Place your SQL statement directly in the text area below and submit your request using the button. You can use the dropdown menus to get information about the database, to query external services or to access example queries.
    {% endblocktrans %}
</p>

<p>
    {% blocktrans %}
        Optionally, you can specify the name of the resulting database table and/or assign a run id, to group associated queries in the job list. Please choose a queue with a suitable timeout for your query.
    {% endblocktrans %}
</p>

<div class="daiquiri-query-dropdowns">
    {% include 'query/query_dropdown_schemas.html' %}
    {% include 'query/query_dropdown_columns.html' %}

    {% for dropdown in settings.QUERY_DROPDOWNS %}
        {% include dropdown.template %}
    {% endfor %}

    {% include 'query/query_dropdown_examples.html' %}
</div>

<div class="daiquiri-query-dropdowns-area" ng-show="service.forms.sql.dropdown">

</div>

<formgroup
    class="row mt-3"
    data-type="codemirror"
    data-label="{% trans 'SQL query' %}"
    data-model="service.forms.sql.values.query"
    data-errors="service.forms.sql.errors.query"
    data-mode="text/x-sql">
</formgroup>

<div class="row mt-2 mb-3">
    <formgroup
        class="col-md-4"
        data-type="text"
        data-label="{% trans 'Results table name' %}"
        data-model="service.forms.sql.values.table_name"
        data-errors="service.forms.sql.errors.table_name">
    </formgroup>
    <formgroup
        class="col-md-2"
        data-type="text"
        data-label="{% trans 'Run id' %}"
        data-model="service.forms.sql.values.run_id"
        data-errors="service.forms.sql.errors.run_id">
    </formgroup>
</div>

<div class="row">
    <button type="button" class="btn btn-primary text-nowrap col-md-2" ng-click="service.forms.sql.submit()">
        {% trans 'Submit query' %} <submitting />
    </button>

    <button type="button" class="btn btn-outline-secondary text-nowrap col-md-2 ms-auto" ng-click="service.forms.sql.clear_query()">
        {% trans 'Clear input window' %}
    </button>
</div>

<p class="text-danger" ng-show="service.forms.sql.errors.detail">
    {$ service.forms.sql.errors.detail $}
</p>
<p class="text-danger" ng-show="service.forms.sql.errors.server_error">
    {% trans 'There has been an error on the server. Please contact the maintainers of this site if the problem persists.' %}
</p>
